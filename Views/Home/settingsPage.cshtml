@using DropShip.Models
@model UpdateUser
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .whiteBG {
            background: white;
        }
        .main {
            border-radius: 10px;
            height: 100vh;
            margin-bottom: -85px;
            overflow: auto;
            text-align: center;
        }
        table {
            margin-top: 4%;
        }
        .rowD {
            font-size: 25px;
            background: rgb(242,242,242);
            font-family: monospace;
            vertical-align: middle !important;
        }
        .rowE {
            font-size: 25px;
            background: rgb(255,255,255);
            font-family: monospace;
            vertical-align: middle !important;
        }
        .lh21 {
            line-height: 2;
        }
        td input {
            text-indent: 5px;
        }
        .hiddenRow {
            display: none;
        }
        .hiddenButton {
            display: none;
        }
        .thStyle1 {
            min-width: 160px;
        }
        .btn-purple {
            color: white;
            background: rgb(133,54,136);
        }
        .btn-darkBlue {
            color: white;
            background: rgb(40,70,160);
        }
        .btn-medBlue {
            width: 45%;
            display: inline-block;
            color: white;
            background: rgb(37,98,179);
            vertical-align: top !important;
        }
        .btn-info2 {
            height: 35px !important;
            margin-top: 5px;
        }
        .noShowInputs {
            border: 0px;
            padding: 4px;
            background: transparent !important;
        }
        .SearchForm {
            display: inline-block;
            vertical-align: middle !important;
        }
        .textInput1 {
            width: 50%;
            text-align: center;
        }
        .textInput2 {
            width: 50%;
            display: inline-block;
        }
        .textInput3 {
            display: block;
            width: 100%;
        }
        .even1 {
            text-align: center;
            vertical-align: middle !important;
            display: inline-block;
        }
        .addProductRow {
            display: none;
        }
        td {
            vertical-align: middle !important;
        }
    </style>
</head>
<body>
    <div class="whiteBG main container">
        <table class="table table-striped table-bordered table-sm">
            <tr>
                <th colspan="2"><h2>Settings</h2></th>
            </tr>
            <form asp-action="UpdateInfo" asp-controller="Home" method="post">
                <tr>
                    <td>
                        <h5>First Name</h5>
                    </td>
                    <td>
                        <span asp-validation-for="FirstName"></span>
                        <input id="FirstName" class="textInput1" type="text" value="@ViewBag.CurrUser.FirstName" name="FirstName" required="">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>Last Name</h5>
                    </td>
                    <td>
                        <span asp-validation-for="LastName"></span>
                        <input id="LastName" class="textInput1" type="text" value="@ViewBag.CurrUser.LastName" name="LastName" required="">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>Email</h5>
                    </td>
                    <td>
                        <span asp-validation-for="Email"></span>
                        <input id="Email" class="textInput1" type="email" value="@ViewBag.CurrUser.Email" name="Email" required="">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>Phone</h5>
                    </td>
                    <td>
                        <span asp-validation-for="MobilePhone"></span>
                        <input id="Phone" class="textInput1" type="tel" value="@ViewBag.CurrUser.MobilePhone" name="MobilePhone">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>Street</h5>
                    </td>
                    <td>
                        <span asp-validation-for="Street"></span>
                        <input id="Street" class="textInput1" type="text" value="@ViewBag.CurrUser.Street" name="Street">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>Zip Code</h5>
                    </td>
                    <td>
                        <span asp-validation-for="Postal"></span>
                        <input id="Postal" class="textInput1" type="number" value="@ViewBag.CurrUser.Postal" name="Postal">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>City</h5>
                    </td>
                    <td>
                        <span asp-validation-for="City"></span>
                        <input id="City" class="textInput1" type="text" value="@ViewBag.CurrUser.City" name="City">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>State</h5>
                    </td>
                    <td>
                        <span asp-validation-for="State"></span>
                        <input id="State" class="textInput1" type="text" value="@ViewBag.CurrUser.State" name="State" maxlength=2>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>Password</h5>
                    </td>
                    <td>
                        <a href="/settings/changepassword"><button class="btn btn-info btn-info2" type="button">&nbsp; Change Password &nbsp; &nbsp;</button></a>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="hiddenRow">
                        <button class="btn btn-primary btn-block" type="submit">Save</button>
                    </td>
                </tr>
            </form>
            <tr>
                <td colspan="2" id="cancelButtonRow" class="hiddenRow">
                    <button class="btn btn-secondary btn-block">Cancel</button>
                </td>
            </tr>
            <tr>
                <td colspan="2" id="editButtonRow">
                    <button class="btn btn-purple btn-block" type="button">Edit</button>
                </td>
            </tr>
                <td colspan="2"  id="delActButtonRow">
                    <button class="btn btn-danger btn-block" onclick="delAct()">Delete Account</button>
                    @* </a> *@
                </td>
            <tr>
            </tr>
        </table>
        @if(ViewBag.CurrUser.Admin == true)
        {
            <table class="table table-striped table-bordered table-sm">
                <tr>
                    <th colspan="4"><h2>Site Settings</h2></th>
                </tr>
                @* <tr>
                    <td colspan="2">Profile Redirect</td>
                </tr> *@
                <td rowspan="@(@ViewBag.AllUsers.Count + 1)" class="rowD">All Users</td>
                @foreach(var i in ViewBag.AllUsers)
                {
                    <tr>
                        <td class="lh21">@i.FirstName @i.LastName</td>
                        <td>
                        @if(@ViewBag.CurrUser.UserId != i.UserId)
                        {
                            <button onclick="delAct(@i.UserId, '@i.FirstName', '@i.LastName')" class="btn btn-danger">Delete User &nbsp;</button>
                        } else {
                            <button class="btn btn-warning" data-toggle="tooltip" data-placement="left" title="Current User">Current User</button>
                        }
                        </td>
                        <td>
                            @if(i.Admin == true){
                                <button class="btn btn-dark">ADMIN</button>
                            } else {
                                <button class="btn btn-light">USER</button>
                            }
                        </td>
                    </tr>
                }
                <tr>
                    <td class="rowE">Product Controls</td>
                    <td>
                        <button class="btn btn-darkBlue" id="openProductMenu">Add Product</button>
                    </td>
                    <td colspan="2">
                        <form class="SearchForm my-2 my-lg-0" asp-action="SearchProductsAdmin" asp-controller="Home">
                            <input class="form-control mr-sm-2 textInput2" type="search" name="sTerm" aria-label="Search">
                            <button class="btn btn-medBlue">Search Products</button>
                        </form>
                    </td>
                </tr>
                <tr class="addProductRow">
                    <td class="rowD">Add Product</td>
                    <form class="my-2 my-lg-0" asp-action="AddProduct" asp-controller="Home">
                        <td>
                            <input type="text" class="form-control mr-sm-2" placeholder="Product Name" name="ProductName" autocomplete="off">
                        </td>
                        <td>
                            <input type="number" class="form-control mr-sm-2" placeholder="Product Price" name="ProductPrice">
                        </td>
                        <td>
                            <input type="number" class="form-control mr-sm-2 even1" placeholder="Number of Images" name="NumberOfImgs">
                        </td>
                        <tr class="addProductRow">
                            <td colspan="2">
                                <input type="text" class="form-control mr-sm-2 even1" placeholder="Product Description" name="ProductDescription">
                            </td>
                            <td>
                                <input type="text" class="form-control mr-sm-2 even1" placeholder="Product Keywords" name="ProductKeywords">
                            </td>
                            <td>
                                <button class="btn btn-success even1" type="submit">Add</button>
                            </td>
                        </tr>
                    </form>
                </tr>
                <tr>
                    <td class="rowE">Order Controls</td>
                    <td>
                        <a href="/UnfilledOrders">
                            <button class="btn btn-darkBlue" id="openProductMenu">View Unfilled Orders</button>
                        </a>
                    </td>
                    <td colspan="2">
                        <form class="SearchForm my-2 my-lg-0" asp-action="SearchOrdersAdmin" asp-controller="Home">
                            <input class="form-control mr-sm-2 textInput2" type="search" name="sTerm" aria-label="Search">
                            <button class="btn btn-medBlue">Search Orders</button>
                        </form>
                    </td>
                </tr>
            </table>
        }
        @if(ViewBag.SearchedProducts != null){
            <table class="table table-striped table-bordered table-sm">
                <tr>
                    <th colspan="7"><h2>Product Search</h2></th>
                </tr>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Keywords</th>
                    <th>Number of Images</th>
                    <th class="thStyle1">Action</th>
                </tr>
                    @foreach(var j in ViewBag.SearchedProducts){
                        <form asp-action="UpdateProduct" asp-controller="Home" method="post">
                            <tr>
                                <td>
                                    <input type="text" class="mr-sm-2 even1 textInput3 @j.ProductName" id="@j.ProductId@j.ProductId" placeholder="Product Name" name="ProductName" value="@j.ProductName">
                                </td>
                                <td style="width: 165px;">
                                    <input type="text" class="mr-sm-2 even1 textInput3 @j.ProductName" id="@j.ProductId@j.ProductId@j.ProductId" placeholder="Product Description" name="ProductDescription" value="@j.ProductDescription">
                                </td>
                                <td>
                                    <input type="number" class="mr-sm-2 even1 textInput3 @j.ProductName" id="@j.ProductId@j.ProductId@j.ProductId@j.ProductId" placeholder="Product Price" name="ProductPrice" value="@j.ProductPrice">
                                </td>
                                <td style="width: 50px;">
                                    <input type="text" class="mr-sm-2 even1 textInput3 @j.ProductName" id="@j.ProductId@j.ProductId@j.ProductId@j.ProductId@j.ProductId" placeholder="Product Keywords" name="ProductKeywords" value="@j.ProductKeywords">
                                </td>
                                <td style="width: 15%;">
                                    <input type="number" class="mr-sm-2 even1 textInput3 @j.ProductName" id="@j.ProductId@j.ProductId@j.ProductId@j.ProductId@j.ProductId@j.ProductId" placeholder="Number of Images" name="NumberOfImgs" value="@j.NumberOfImgs">
                                </td>
                                <td>
                                    <button id="editProduct" class="btn btn-purple @j.ProductId@j.ProductName disabledButton" onclick="editProd('@j.ProductName','@j.ProductId')" type="button">Edit</button>
                                    <button id="deleteProduct" class="btn btn-danger @j.ProductId@j.ProductName disabledButton" onclick="delProd(@j.ProductId, '@j.ProductName')" type="button">Delete</button>
                                    <button id="cancelProduct" class="btn btn-secondary hiddenButton @j.ProductName@j.ProductId" onclick="cancelProd('@j.ProductName','@j.ProductId')" type="button">Cancel</button>
                                    <button id="saveProduct" class="btn btn-primary hiddenButton @j.ProductName@j.ProductId" type="submit">Save</button>
                                </td>
                            </tr>
                        </form>
                    }
            </table>
        }
    </div>
    <script>
        function delAct(id,first,last) {
                if(id == null){
                    var r = confirm("Delete Account?");
                    if (r == true) {
                        window.location.replace("/users/delete/@ViewBag.CurrUser.UserId");
                    }
                }
                else{
                    var r = confirm(`Delete ${first} ${last}'s Account?`);
                    if (r == true) {
                        window.location.replace("/users/delete/" + id);
                    }
                }
        }
        function delProd(id, name) {
            var r = confirm(`Delete "${name}"?`);
            if (r == true) {
                window.location.replace("/products/delete/" + id);
            }
        }
        $('.textInput1').prop('readonly', true);
        $('.textInput1').prop('disabled', true);
        $('.textInput1').addClass('noShowInputs')
        $('.textInput3').prop('readonly', true);
        $('.textInput3').prop('disabled', true);
        $('.textInput3').addClass('noShowInputs')
        var firstNameInput = document.getElementById('FirstName').value;
        var lastNameInput = document.getElementById('LastName').value;
        var emailInput = document.getElementById('Email').value;
        var phoneInput = document.getElementById('Phone').value;
        var streetInput = document.getElementById('Street').value;
        var postalInput = document.getElementById('Postal').value;
        var cityInput = document.getElementById('City').value;
        var stateInput = document.getElementById('State').value;
        $('#editButtonRow').click(function(){
            $('.textInput1').prop('readonly', false);
            $('.textInput1').prop('disabled', false);
            $('.textInput1').removeClass('noShowInputs');
            $('.hiddenRow').show();
            $('#delActButtonRow').hide();
            $(this).hide();
        });
        $('#cancelButtonRow').click(function(){
            document.getElementById('FirstName').value = firstNameInput;
            document.getElementById('LastName').value = lastNameInput;
            document.getElementById('Email').value = emailInput;
            document.getElementById('Phone').value = phoneInput;
            document.getElementById('Street').value = streetInput ;
            document.getElementById('Postal').value = postalInput ;
            document.getElementById('City').value = cityInput ;
            document.getElementById('State').value = stateInput ;
            $('.textInput1').prop('readonly', true);
            $('.textInput1').prop('disabled', true);
            $('.textInput1').addClass('noShowInputs');
            $('.hiddenRow').hide();
            $('#editButtonRow').show();
            $('#delActButtonRow').show();
            $(this).hide();
        });
        $('#openProductMenu').click(function(){
            $(".addProductRow").toggle();
        });
        function editProd(name, id){
            @* saveProdData(id);
            console.log(saveProdData()); *@
            $('.'+name).prop('readonly', false);
            $('.'+name).prop('disabled', false);
            $('.'+name).removeClass('noShowInputs');
            $('.disabledButton').prop('disabled', true);
            $('.'+id+name).hide();
            $('.'+name+id).show();
        };
        
        function cancelProd(name, id){
            $('.'+name).prop('readonly', true);
            $('.'+name).prop('disabled', true);
            $('.'+name).addClass('noShowInputs');
            $('.disabledButton').prop('disabled', false);
            $('.'+id+name).show();
            $('.'+name+id).hide();
        };
    </script>
</body>
</html>